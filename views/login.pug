doctype html
html
  - const pageTitle = "Login"
  include includes/head.pug
  body
    include includes/navbar.pug
    div.container
      div.row.justify-content-center.mt-5
        div.col-md-6
          h1.text-center Login
          form(id="loginForm", action="/login", method="post")
            div.form-group
              div.input-group
                div.input-group-prepend
                  span.input-group-text
                    i.fas.fa-user
                input(type="text", class="form-control", name="username", id="usernameInput", placeholder="Username", required)
            div.form-group
              div.input-group
                div.input-group-prepend
                  span.input-group-text
                    i.fas.fa-lock
                input(type="password", class="form-control", name="password", id="passwordInput", placeholder="Password", required)
            button(type="submit", class="btn btn-primary btn-block mt-3", id="loginButton") Login

          script.
            // Prevent form submission on Enter key press
            document.addEventListener("keydown", function(event) {
              if (event.key === "Enter" && event.target.tagName !== "TEXTAREA" && event.target.tagName !== "INPUT") {
                event.preventDefault();
              }
            });

            // Handle login with vanilla JavaScript
            document.addEventListener("DOMContentLoaded", function() {
              document.querySelector("form").addEventListener("submit", function(event) {
                event.preventDefault(); // Prevent the form from submitting normally

                var username = document.getElementById("usernameInput").value;
                var password = document.getElementById("passwordInput").value;

                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/login", true);
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.onreadystatechange = function() {
                  if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                      var data = JSON.parse(xhr.responseText);

                      // Check if login was successful
                      if (data.token) {
                        // Save the token as a cookie
                        document.cookie = "token=" + data.token;

                        // Redirect to a new page or perform other actions
                        window.location.href = "/"; // Change this URL as needed
                      } else {
                        // Display the error message from the server
                        showError("Login failed: " + data.error);
                      }
                    } else if (xhr.status == 401) {
                      // Unauthorized - Incorrect username or password
                      showError("Invalid username or password. Please try again.");
                    } else {
                      // Handle other server errors or HTTP status codes
                      showError("Failed to make the login request. Please try again later.");
                    }
                  }
                };

                // Convert the data to JSON format
                var jsonData = JSON.stringify({ username: username, password: password });

                // Send the request
                xhr.send(jsonData);
              });

              function showError(message) {
                // Display error using Bootstrap alert
                var alertDiv = document.createElement("div");
                alertDiv.className = "alert alert-danger mt-3";
                alertDiv.textContent = message;

                // Insert the alert above the form
                var form = document.querySelector("form");
                form.parentNode.insertBefore(alertDiv, form.nextSibling);

                // Remove the alert after a few seconds
                setTimeout(function() {
                  alertDiv.parentNode.removeChild(alertDiv);
                }, 5000);
              }
            });
    include includes/footer.pug
    include includes/scripts.pug
